{% load static %}
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap CSS -->
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'bootstrap/css/bootstrap-icons.css' %}" rel="stylesheet" type="text/css">
    
    <!-- Custom CSS Variables & Theme -->
    <link href="{% static 'css/variables.css' %}" rel="stylesheet" type="text/css">

    <!-- Scripts -->
    <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'jquery/jquery-3.7.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'modal/modal.js' %}" type="text/javascript"></script>
    {{ redirect_to_login_immediately }}

    {% block customjs %}
    {% endblock %}

    {% block customcss %}
    {% endblock %}

    <title>{% block title %}DGP - Group Protocol System{% endblock %}</title>
</head>
<body>

{% block nav %}
    {% include "base/navigation.html" %}
{% endblock %}

<main class="container mt-4 mb-5">
    {% block content %}
    {% endblock %}
</main>

{% include "base/toast.html" %}

<script>
    // Theme Management
    class ThemeManager {
        constructor() {
            this.darkModeKey = 'dgp-dark-mode';
            this.init();
        }
        
        init() {
            // Check localStorage first, then system preference
            const savedTheme = localStorage.getItem(this.darkModeKey);
            if (savedTheme !== null) {
                this.setDarkMode(savedTheme === 'true');
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                this.setDarkMode(true);
            }
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                this.setDarkMode(e.matches);
            });
        }
        
        setDarkMode(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
                localStorage.setItem(this.darkModeKey, 'true');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem(this.darkModeKey, 'false');
            }
        }
        
        toggle() {
            const isDark = document.body.classList.contains('dark-mode');
            this.setDarkMode(!isDark);
        }
    }
    
    // Initialize theme manager
    const themeManager = new ThemeManager();
    
    // Make toggle available globally
    window.toggleDarkMode = () => themeManager.toggle();
</script>

{% block modal %}
    <!-- Modal -->
    <div class="modal modal-lg fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modal"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div id="modal-content" class="modal-content fade-in">
            </div>
        </div>
    </div>
{% endblock %}

</body>
</html>